#!/usr/bin/env python2

"""
Author: Ralf Hauenschild
E-Mail: ralf_hauenschild@gmx.de
"""



################################################
# Library imports
################################################

import os
import sys
import copy                            # VERY IMPORTANT: Necessary for copying variables
from time import *
import math
import shutil
from operator import itemgetter
from random import shuffle


mismFeatureSet = {
    'A': 'gmism\ttmism\tcmism\t',
    'G': 'amism\ttmism\tcmism\t',
    'C': 'amism\tgmism\ttmism\t',
    'T': 'amism\tgmism\tcmism\t'
}

annotations = {'A': {u'"': {'>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [58], '>tdbR00000464|Saccharomyces_cerevisiae|4932|Val|AAC': [59], '>Lys_TTT': [9], '>tdbR00000444|Saccharomyces_cerevisiae|4932|Thr|AGT': [58], '>tdbR00000300|Saccharomyces_cerevisiae|4932|Asn|GTT': [59], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [58], '>Leu_TAG': [9], '>tdbR00000443|Saccharomyces_cerevisiae|4932|Thr|AGT': [58], '>Ser_GCT': [43], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [69], '>Pro_TGG': [9], '>tdbM00000009|Saccharomyces_cerevisiae|4932|Ser|GCT': [67], '>tdbR00000323|Saccharomyces_cerevisiae|4932|Pro|TGG': [57], '>Asp_GTC': [9], '>tdbM00000007|Saccharomyces_cerevisiae|4932|Ini|CAT': [57], '>tdbR00000324|Saccharomyces_cerevisiae|4932|Pro|TGG': [57], '>tdbR00000526|Saccharomyces_cerevisiae|4932|Ini|CAT': [57], '>tdbR00000465|Saccharomyces_cerevisiae|4932|Val|CAC': [58], '>tdbR00000494|Saccharomyces_cerevisiae|4932|Trp|CCA': [57], '>tdbR00000250|Saccharomyces_cerevisiae|4932|Leu|TAG': [67], '>tdbM00000006|Saccharomyces_cerevisiae|4932|Ile|TAT': [58], '>tdbR00000555|Saccharomyces_cerevisiae|4932|Tyr|GTA': [60], '>tdbR00000193|Saccharomyces_cerevisiae|4932|Lys|TTT': [58], '>tdbR00000369|Saccharomyces_cerevisiae|4932|Arg|ACG': [58], '>tdbR00000370|Saccharomyces_cerevisiae|4932|Arg|TCT': [57], '>tdbR00000170|Saccharomyces_cerevisiae|4932|Ile|AAT': [59], '>tdbR00000466|Saccharomyces_cerevisiae|4932|Val|TAC': [59], '>tdbR00000192|Saccharomyces_cerevisiae|4932|Lys|CTT': [58], '>long_subunit_long': [645, 2143], '>Leu_TAA': [60], '>tdbR00000371|Saccharomyces_cerevisiae|4932|Arg|TCT': [57], '>tdbR00000284|Saccharomyces_cerevisiae|4932|Met|CAT': [58], '>tdbR00000021|Saccharomyces_cerevisiae|4932|Cys|GCA': [57]}, u'I': {'>tdbR00000443|Saccharomyces_cerevisiae|4932|Thr|AGT': [34], '>tdbR00000464|Saccharomyces_cerevisiae|4932|Val|AAC': [35], '>tdbR00000369|Saccharomyces_cerevisiae|4932|Arg|ACG': [34], '>tdbR00000444|Saccharomyces_cerevisiae|4932|Thr|AGT': [34], '>tdbR00000408|Saccharomyces_cerevisiae|4932|Ser|AGA': [34], '>tdbR00000012|Saccharomyces_cerevisiae|4932|Ala|AGC': [34], '>tdbR00000170|Saccharomyces_cerevisiae|4932|Ile|AAT': [35], '>tdbR00000407|Saccharomyces_cerevisiae|4932|Ser|AGA': [34]}, u'+': {'>tdbM00000008|Saccharomyces_cerevisiae|4932|Ser|CGA': [37], '>tdbR00000555|Saccharomyces_cerevisiae|4932|Tyr|GTA': [39], '>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [37], '>tdbR00000408|Saccharomyces_cerevisiae|4932|Ser|AGA': [37], '>tdbR00000021|Saccharomyces_cerevisiae|4932|Cys|GCA': [36], '>tdbR00000407|Saccharomyces_cerevisiae|4932|Ser|AGA': [37]}, u'\u03b6': {'>short_subunit': [1781, 1782]}, u'O': {'>tdbR00000012|Saccharomyces_cerevisiae|4932|Ala|AGC': [37]}, u'6': {'>tdbR00000192|Saccharomyces_cerevisiae|4932|Lys|CTT': [37], '>tdbR00000443|Saccharomyces_cerevisiae|4932|Thr|AGT': [37], '>Ser_GCT': [23], '>tdbM00000006|Saccharomyces_cerevisiae|4932|Ile|TAT': [37], '>Lys_TTT': [32], '>tdbR00000444|Saccharomyces_cerevisiae|4932|Thr|AGT': [37], '>tdbM00000009|Saccharomyces_cerevisiae|4932|Ser|GCT': [37], '>Ile_GAT': [33], '>tdbM00000002|Saccharomyces_cerevisiae|4932|Arg|CCT': [36], '>tdbR00000371|Saccharomyces_cerevisiae|4932|Arg|TCT': [36], '>tdbR00000193|Saccharomyces_cerevisiae|4932|Lys|TTT': [37], '>tdbR00000284|Saccharomyces_cerevisiae|4932|Met|CAT': [37], '>tdbM00000007|Saccharomyces_cerevisiae|4932|Ini|CAT': [36], '>tdbR00000370|Saccharomyces_cerevisiae|4932|Arg|TCT': [36], '>tdbR00000170|Saccharomyces_cerevisiae|4932|Ile|AAT': [38], '>tdbR00000300|Saccharomyces_cerevisiae|4932|Asn|GTT': [38], '>tdbR00000526|Saccharomyces_cerevisiae|4932|Ini|CAT': [36]}, u':': {'>long_subunit_long': [649, 807, 817, 876, 1133, 1450, 2222, 2258, 2282, 2283, 2642, 2950], '>short_subunit': [28, 100, 420, 436, 541, 619, 796, 974]}, u'^': {'>tdbM00000007|Saccharomyces_cerevisiae|4932|Ini|CAT': [63], '>tdbR00000526|Saccharomyces_cerevisiae|4932|Ini|CAT': [63]}}, 'C': {u'B': {'>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [32], '>tdbR00000494|Saccharomyces_cerevisiae|4932|Trp|CCA': [31, 33], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [33], '>short_subunit': [414, 1007, 1639], '>long_subunit_long': [650, 663, 1437, 2198, 2339, 2952, 2963], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [32]}, u"'": {'>tdbR00000444|Saccharomyces_cerevisiae|4932|Thr|AGT': [32], '>tdbR00000443|Saccharomyces_cerevisiae|4932|Thr|AGT': [32], '>tdbM00000008|Saccharomyces_cerevisiae|4932|Ser|CGA': [32]}, u'M': {'>tdbR00000249|Saccharomyces_cerevisiae|4932|Leu|CAA': [12], '>tdbR00000250|Saccharomyces_cerevisiae|4932|Leu|TAG': [12], '>tdbM00000008|Saccharomyces_cerevisiae|4932|Ser|CGA': [12], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [12], '>tdbM00000009|Saccharomyces_cerevisiae|4932|Ser|GCT': [12], '>short_subunit': [1280, 1773], '>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [12], '>tdbR00000408|Saccharomyces_cerevisiae|4932|Ser|AGA': [12], '>tdbR00000407|Saccharomyces_cerevisiae|4932|Ser|AGA': [12]}, u'<': {'>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [32]}, u'?': {'>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [40, 49], '>tdbR00000145|Saccharomyces_cerevisiae|4932|His|GTG': [49], '>tdbR00000464|Saccharomyces_cerevisiae|4932|Val|AAC': [50], '>tdbR00000035|Saccharomyces_cerevisiae|4932|Asp|GTC': [48], '>tdbR00000444|Saccharomyces_cerevisiae|4932|Thr|AGT': [48], '>tdbR00000249|Saccharomyces_cerevisiae|4932|Leu|CAA': [35, 57], '>tdbR00000300|Saccharomyces_cerevisiae|4932|Asn|GTT': [49], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [40, 49], '>tdbM00000003|Saccharomyces_cerevisiae|4932|Gln|TTG': [48], '>tdbR00000443|Saccharomyces_cerevisiae|4932|Thr|AGT': [48], '>tdbM00000008|Saccharomyces_cerevisiae|4932|Ser|CGA': [57], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [59], '>tdbM00000009|Saccharomyces_cerevisiae|4932|Ser|GCT': [57], '>tdbM00000007|Saccharomyces_cerevisiae|4932|Ini|CAT': [47, 48], '>tdbR00000129|Saccharomyces_cerevisiae|4932|Gly|GCC': [46], '>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [57], '>tdbR00000526|Saccharomyces_cerevisiae|4932|Ini|CAT': [47, 48], '>tdbR00000465|Saccharomyces_cerevisiae|4932|Val|CAC': [49], '>tdbR00000250|Saccharomyces_cerevisiae|4932|Leu|TAG': [57], '>tdbM00000006|Saccharomyces_cerevisiae|4932|Ile|TAT': [48], '>tdbR00000555|Saccharomyces_cerevisiae|4932|Tyr|GTA': [50], '>tdbR00000054|Saccharomyces_cerevisiae|4932|Glu|TTC': [48], '>tdbR00000193|Saccharomyces_cerevisiae|4932|Lys|TTT': [48], '>tdbR00000369|Saccharomyces_cerevisiae|4932|Arg|ACG': [49], '>tdbR00000170|Saccharomyces_cerevisiae|4932|Ile|AAT': [49], '>tdbR00000466|Saccharomyces_cerevisiae|4932|Val|TAC': [50], '>tdbM00000004|Saccharomyces_cerevisiae|4932|Glu|CTC': [48], '>long_subunit_long': [2280, 2874], '>Leu_TAA': [50], '>tdbR00000284|Saccharomyces_cerevisiae|4932|Met|CAT': [48], '>tdbR00000144|Saccharomyces_cerevisiae|4932|His|GTG': [49], '>tdbR00000408|Saccharomyces_cerevisiae|4932|Ser|AGA': [57], '>tdbR00000021|Saccharomyces_cerevisiae|4932|Cys|GCA': [47], '>tdbR00000407|Saccharomyces_cerevisiae|4932|Ser|AGA': [57]}, u'>': {'>Met_CAT': [31]}}, 'T': {u'\u03b1': {'>short_subunit': [1191]}, u'\u2203': {'>Lys_TTT': [29]}, u'\xca': {'>Leu_TAA': [36]}, u'D': {'>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [16, 17], '>tdbR00000249|Saccharomyces_cerevisiae|4932|Leu|CAA': [19, 21], '>tdbR00000464|Saccharomyces_cerevisiae|4932|Val|AAC': [16, 20, 21, 48], '>tdbM00000002|Saccharomyces_cerevisiae|4932|Arg|CCT': [16, 19, 47], '>tdbR00000035|Saccharomyces_cerevisiae|4932|Asp|GTC': [16, 19], '>tdbR00000444|Saccharomyces_cerevisiae|4932|Thr|AGT': [16, 17, 20, 47], '>tdbR00000145|Saccharomyces_cerevisiae|4932|His|GTG': [17, 20, 21], '>tdbR00000300|Saccharomyces_cerevisiae|4932|Asn|GTT': [16, 17, 20, 21, 48], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [16, 17], '>tdbM00000003|Saccharomyces_cerevisiae|4932|Gln|TTG': [16, 19, 20], '>tdbR00000443|Saccharomyces_cerevisiae|4932|Thr|AGT': [16, 17, 20, 47], '>tdbR00000130|Saccharomyces_cerevisiae|4932|Gly|NCC': [16, 19, 20], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [16, 19, 21], '>tdbM00000009|Saccharomyces_cerevisiae|4932|Ser|GCT': [16, 19, 20], '>tdbR00000323|Saccharomyces_cerevisiae|4932|Pro|TGG': [16, 19], '>tdbM00000007|Saccharomyces_cerevisiae|4932|Ini|CAT': [16, 46], '>tdbR00000129|Saccharomyces_cerevisiae|4932|Gly|GCC': [16, 19], '>tdbM00000005|Saccharomyces_cerevisiae|4932|Gly|TCC': [16, 19, 20], '>tdbR00000324|Saccharomyces_cerevisiae|4932|Pro|TGG': [16, 19], '>tdbR00000526|Saccharomyces_cerevisiae|4932|Ini|CAT': [16, 46], '>tdbR00000465|Saccharomyces_cerevisiae|4932|Val|CAC': [20, 47], '>tdbR00000494|Saccharomyces_cerevisiae|4932|Trp|CCA': [16, 19, 46], '>tdbR00000250|Saccharomyces_cerevisiae|4932|Leu|TAG': [16, 19, 20, 21], '>tdbM00000006|Saccharomyces_cerevisiae|4932|Ile|TAT': [16, 19, 20, 47], '>tdbR00000555|Saccharomyces_cerevisiae|4932|Tyr|GTA': [16, 17, 20, 21, 22, 49], '>tdbR00000054|Saccharomyces_cerevisiae|4932|Glu|TTC': [20], '>tdbR00000193|Saccharomyces_cerevisiae|4932|Lys|TTT': [16, 17, 20, 47], '>tdbR00000369|Saccharomyces_cerevisiae|4932|Arg|ACG': [16, 19, 47], '>tdbR00000370|Saccharomyces_cerevisiae|4932|Arg|TCT': [16, 46], '>tdbR00000170|Saccharomyces_cerevisiae|4932|Ile|AAT': [16, 17, 20, 21, 48], '>tdbR00000466|Saccharomyces_cerevisiae|4932|Val|TAC': [16, 19, 20, 48], '>tdbM00000004|Saccharomyces_cerevisiae|4932|Glu|CTC': [20], '>tdbM00000008|Saccharomyces_cerevisiae|4932|Ser|CGA': [16, 19, 20], '>tdbR00000192|Saccharomyces_cerevisiae|4932|Lys|CTT': [16, 20], '>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [16, 19, 20], '>Leu_TAA': [21], '>tdbR00000371|Saccharomyces_cerevisiae|4932|Arg|TCT': [16, 46], '>tdbR00000284|Saccharomyces_cerevisiae|4932|Met|CAT': [16, 47], '>tdbR00000144|Saccharomyces_cerevisiae|4932|His|GTG': [17, 20, 21], '>tdbR00000408|Saccharomyces_cerevisiae|4932|Ser|AGA': [16, 19, 20], '>tdbR00000012|Saccharomyces_cerevisiae|4932|Ala|AGC': [16, 20, 47], '>tdbM00000001|Saccharomyces_cerevisiae|4932|Ala|TGC': [16, 17, 20, 47], '>tdbR00000021|Saccharomyces_cerevisiae|4932|Cys|GCA': [16, 19, 46], '>tdbR00000407|Saccharomyces_cerevisiae|4932|Ser|AGA': [16, 19, 20]}, u'&': {'>tdbR00000466|Saccharomyces_cerevisiae|4932|Val|TAC': [35], '>tdbM00000001|Saccharomyces_cerevisiae|4932|Ala|TGC': [34]}, u')': {'>tdbR00000193|Saccharomyces_cerevisiae|4932|Lys|TTT': [34]}, u'J': {'>tdbM00000008|Saccharomyces_cerevisiae|4932|Ser|CGA': [44], '>tdbM00000009|Saccharomyces_cerevisiae|4932|Ser|GCT': [44], '>short_subunit': [578, 1269], '>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [44], '>tdbR00000408|Saccharomyces_cerevisiae|4932|Ser|AGA': [44], '>long_subunit_long': [898, 1889, 2349, 2419, 2423, 2727, 2732, 2925], '>tdbR00000407|Saccharomyces_cerevisiae|4932|Ser|AGA': [44]}, u'N': {'>tdbR00000323|Saccharomyces_cerevisiae|4932|Pro|TGG': [33], '>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [34], '>tdbM00000005|Saccharomyces_cerevisiae|4932|Gly|TCC': [34], '>tdbR00000324|Saccharomyces_cerevisiae|4932|Pro|TGG': [33]}, u'1': {'>tdbR00000370|Saccharomyces_cerevisiae|4932|Arg|TCT': [33], '>tdbR00000371|Saccharomyces_cerevisiae|4932|Arg|TCT': [33]}, u'P': {'>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [39, 55], '>tdbR00000249|Saccharomyces_cerevisiae|4932|Leu|CAA': [33, 40, 64], '>tdbR00000464|Saccharomyces_cerevisiae|4932|Val|AAC': [13, 28, 33, 56], '>Lys_TTT': [22, 23], '>Met_CAT': [24, 46], '>tdbM00000002|Saccharomyces_cerevisiae|4932|Arg|CCT': [54], '>tdbR00000035|Saccharomyces_cerevisiae|4932|Asp|GTC': [13, 32, 54], '>tdbR00000444|Saccharomyces_cerevisiae|4932|Thr|AGT': [39, 55], '>tdbR00000145|Saccharomyces_cerevisiae|4932|His|GTG': [14, 33, 55], '>tdbR00000300|Saccharomyces_cerevisiae|4932|Asn|GTT': [40, 56], '>short_subunit': [106, 120, 211, 302, 466, 632, 759, 766, 999, 1181, 1187, 1290, 1415], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [39, 55], '>tdbM00000003|Saccharomyces_cerevisiae|4932|Gln|TTG': [32, 38, 54], '>tdbR00000443|Saccharomyces_cerevisiae|4932|Thr|AGT': [39, 55], '>tdbR00000130|Saccharomyces_cerevisiae|4932|Gly|NCC': [13, 54], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [40, 66], '>Pro_TGG': [25, 26, 30, 36, 51], '>tdbM00000009|Saccharomyces_cerevisiae|4932|Ser|GCT': [64], '>tdbR00000323|Saccharomyces_cerevisiae|4932|Pro|TGG': [13, 31, 37, 54], '>Asp_GTC': [24], '>Leu_TAG': [26, 27, 30], '>tdbR00000129|Saccharomyces_cerevisiae|4932|Gly|GCC': [13, 31, 37, 52], '>tdbM00000005|Saccharomyces_cerevisiae|4932|Gly|TCC': [13, 54], '>tdbR00000324|Saccharomyces_cerevisiae|4932|Pro|TGG': [13, 31, 37, 54], '>long_subunit_long': [776, 960, 966, 986, 990, 1004, 1042, 1052, 1056, 1110, 1124, 2130, 2134, 2192, 2260, 2262, 2266, 2268, 2316, 2342, 2351, 2353, 2418, 2738, 2830, 2869, 2884, 2927, 2948, 2979], '>tdbR00000465|Saccharomyces_cerevisiae|4932|Val|CAC': [13, 27, 28, 32, 55], '>tdbR00000494|Saccharomyces_cerevisiae|4932|Trp|CCA': [25, 26, 27, 38, 54, 64], '>tdbR00000250|Saccharomyces_cerevisiae|4932|Leu|TAG': [28, 33, 40, 64], '>tdbM00000006|Saccharomyces_cerevisiae|4932|Ile|TAT': [27, 34, 36, 55, 67], '>tdbR00000555|Saccharomyces_cerevisiae|4932|Tyr|GTA': [37, 41, 57], '>tdbR00000054|Saccharomyces_cerevisiae|4932|Glu|TTC': [13, 27, 54], '>tdbR00000193|Saccharomyces_cerevisiae|4932|Lys|TTT': [27, 28, 55, 67], '>tdbR00000369|Saccharomyces_cerevisiae|4932|Arg|ACG': [27, 55], '>tdbR00000370|Saccharomyces_cerevisiae|4932|Arg|TCT': [26, 38, 54], '>tdbR00000170|Saccharomyces_cerevisiae|4932|Ile|AAT': [56], '>tdbR00000466|Saccharomyces_cerevisiae|4932|Val|TAC': [28, 33, 56], '>long_subunit_short': [73], '>tdbM00000004|Saccharomyces_cerevisiae|4932|Glu|CTC': [13, 27, 54], '>tdbM00000008|Saccharomyces_cerevisiae|4932|Ser|CGA': [39, 64], '>tdbR00000192|Saccharomyces_cerevisiae|4932|Lys|CTT': [27, 39, 55], '>Leu_TAA': [29, 57], '>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [39, 64], '>Ile_GAT': [23, 24], '>tdbR00000371|Saccharomyces_cerevisiae|4932|Arg|TCT': [26, 38, 54], '>tdbR00000284|Saccharomyces_cerevisiae|4932|Met|CAT': [27, 31, 39, 55], '>tdbR00000144|Saccharomyces_cerevisiae|4932|His|GTG': [14, 33, 40, 55], '>tdbR00000408|Saccharomyces_cerevisiae|4932|Ser|AGA': [32, 39, 64], '>tdbR00000012|Saccharomyces_cerevisiae|4932|Ala|AGC': [38, 55], '>tdbM00000001|Saccharomyces_cerevisiae|4932|Ala|TGC': [55], '>tdbR00000021|Saccharomyces_cerevisiae|4932|Cys|GCA': [31, 38, 54], '>tdbR00000407|Saccharomyces_cerevisiae|4932|Ser|AGA': [32, 39, 64]}, u'3': {'>tdbR00000054|Saccharomyces_cerevisiae|4932|Glu|TTC': [34]}, u'\u03b4': {'>long_subunit_long': [2636, 2847]}}, 'G': {u'#': {'>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [34], '>tdbR00000494|Saccharomyces_cerevisiae|4932|Trp|CCA': [17], '>tdbR00000249|Saccharomyces_cerevisiae|4932|Leu|CAA': [17], '>tdbR00000250|Saccharomyces_cerevisiae|4932|Leu|TAG': [17], '>tdbM00000008|Saccharomyces_cerevisiae|4932|Ser|CGA': [17], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [17], '>tdbM00000009|Saccharomyces_cerevisiae|4932|Ser|GCT': [17], '>tdbR00000555|Saccharomyces_cerevisiae|4932|Tyr|GTA': [18], '>short_subunit': [1126, 1271, 1428, 1572], '>tdbR00000144|Saccharomyces_cerevisiae|4932|His|GTG': [18], '>tdbR00000145|Saccharomyces_cerevisiae|4932|His|GTG': [18], '>tdbR00000408|Saccharomyces_cerevisiae|4932|Ser|AGA': [17], '>tdbR00000407|Saccharomyces_cerevisiae|4932|Ser|AGA': [17], '>long_subunit_long': [805, 867, 908, 1451, 2290, 2621, 2794, 2797, 2819, 2926], '>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [17], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [34]}, u'K': {'>tdbR00000145|Saccharomyces_cerevisiae|4932|His|GTG': [38], '>tdbR00000464|Saccharomyces_cerevisiae|4932|Val|AAC': [9], '>tdbM00000002|Saccharomyces_cerevisiae|4932|Arg|CCT': [9], '>tdbR00000035|Saccharomyces_cerevisiae|4932|Asp|GTC': [37], '>tdbR00000249|Saccharomyces_cerevisiae|4932|Leu|CAA': [38], '>Leu_TAG': [36], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [38], '>Pro_TGG': [35], '>tdbR00000323|Saccharomyces_cerevisiae|4932|Pro|TGG': [9, 36], '>tdbM00000007|Saccharomyces_cerevisiae|4932|Ini|CAT': [9], '>tdbR00000129|Saccharomyces_cerevisiae|4932|Gly|GCC': [9], '>tdbR00000324|Saccharomyces_cerevisiae|4932|Pro|TGG': [36], '>tdbR00000526|Saccharomyces_cerevisiae|4932|Ini|CAT': [9], '>tdbR00000494|Saccharomyces_cerevisiae|4932|Trp|CCA': [9], '>tdbR00000250|Saccharomyces_cerevisiae|4932|Leu|TAG': [38], '>tdbR00000369|Saccharomyces_cerevisiae|4932|Arg|ACG': [9], '>tdbR00000370|Saccharomyces_cerevisiae|4932|Arg|TCT': [9], '>tdbR00000170|Saccharomyces_cerevisiae|4932|Ile|AAT': [9], '>Leu_TAA': [9], '>Ile_GAT': [9], '>tdbR00000371|Saccharomyces_cerevisiae|4932|Arg|TCT': [9], '>tdbR00000144|Saccharomyces_cerevisiae|4932|His|GTG': [38], '>tdbR00000012|Saccharomyces_cerevisiae|4932|Ala|AGC': [9], '>tdbM00000001|Saccharomyces_cerevisiae|4932|Ala|TGC': [9]}, u'L': {'>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [10], '>tdbR00000249|Saccharomyces_cerevisiae|4932|Leu|CAA': [10], '>tdbR00000444|Saccharomyces_cerevisiae|4932|Thr|AGT': [10], '>tdbR00000300|Saccharomyces_cerevisiae|4932|Asn|GTT': [10], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [10], '>Leu_TAG': [10], '>tdbR00000443|Saccharomyces_cerevisiae|4932|Thr|AGT': [10], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [10], '>Asp_GTC': [10], '>tdbM00000007|Saccharomyces_cerevisiae|4932|Ini|CAT': [10], '>Lys_TTT': [10], '>tdbR00000526|Saccharomyces_cerevisiae|4932|Ini|CAT': [10], '>tdbR00000465|Saccharomyces_cerevisiae|4932|Val|CAC': [10, 26], '>tdbR00000494|Saccharomyces_cerevisiae|4932|Trp|CCA': [10], '>tdbR00000250|Saccharomyces_cerevisiae|4932|Leu|TAG': [10], '>tdbM00000006|Saccharomyces_cerevisiae|4932|Ile|TAT': [10], '>tdbR00000555|Saccharomyces_cerevisiae|4932|Tyr|GTA': [10], '>tdbR00000193|Saccharomyces_cerevisiae|4932|Lys|TTT': [10], '>tdbR00000369|Saccharomyces_cerevisiae|4932|Arg|ACG': [10], '>tdbR00000370|Saccharomyces_cerevisiae|4932|Arg|TCT': [10], '>tdbR00000170|Saccharomyces_cerevisiae|4932|Ile|AAT': [10], '>tdbR00000466|Saccharomyces_cerevisiae|4932|Val|TAC': [10], '>tdbR00000192|Saccharomyces_cerevisiae|4932|Lys|CTT': [9, 10], '>Leu_TAA': [10], '>tdbR00000371|Saccharomyces_cerevisiae|4932|Arg|TCT': [10], '>tdbR00000284|Saccharomyces_cerevisiae|4932|Met|CAT': [10]}, u'Q': {'>Asp_GTC': [31]}, u'R': {'>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [26], '>tdbR00000249|Saccharomyces_cerevisiae|4932|Leu|CAA': [27], '>tdbM00000002|Saccharomyces_cerevisiae|4932|Arg|CCT': [25], '>tdbR00000444|Saccharomyces_cerevisiae|4932|Thr|AGT': [26], '>tdbR00000300|Saccharomyces_cerevisiae|4932|Asn|GTT': [27], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [26], '>tdbR00000443|Saccharomyces_cerevisiae|4932|Thr|AGT': [26], '>tdbM00000008|Saccharomyces_cerevisiae|4932|Ser|CGA': [26], '>tdbR00000251|Saccharomyces_cerevisiae|4932|Leu|TAA': [27], '>tdbM00000009|Saccharomyces_cerevisiae|4932|Ser|GCT': [26], '>tdbM00000007|Saccharomyces_cerevisiae|4932|Ini|CAT': [25], '>tdbR00000406|Saccharomyces_cerevisiae|4932|Ser|TGA': [26], '>tdbR00000526|Saccharomyces_cerevisiae|4932|Ini|CAT': [25], '>tdbR00000250|Saccharomyces_cerevisiae|4932|Leu|TAG': [27], '>tdbR00000555|Saccharomyces_cerevisiae|4932|Tyr|GTA': [28], '>tdbR00000193|Saccharomyces_cerevisiae|4932|Lys|TTT': [26], '>tdbR00000369|Saccharomyces_cerevisiae|4932|Arg|ACG': [26], '>tdbR00000370|Saccharomyces_cerevisiae|4932|Arg|TCT': [25], '>tdbR00000466|Saccharomyces_cerevisiae|4932|Val|TAC': [27], '>tdbR00000192|Saccharomyces_cerevisiae|4932|Lys|CTT': [26], '>Ile_GAT': [22], '>tdbR00000371|Saccharomyces_cerevisiae|4932|Arg|TCT': [25], '>tdbR00000284|Saccharomyces_cerevisiae|4932|Met|CAT': [26], '>tdbR00000408|Saccharomyces_cerevisiae|4932|Ser|AGA': [26], '>tdbR00000012|Saccharomyces_cerevisiae|4932|Ala|AGC': [26], '>tdbM00000001|Saccharomyces_cerevisiae|4932|Ala|TGC': [26], '>tdbR00000407|Saccharomyces_cerevisiae|4932|Ser|AGA': [26]}, u'7': {'>tdbR00000192|Saccharomyces_cerevisiae|4932|Lys|CTT': [46], '>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [46], '>tdbM00000006|Saccharomyces_cerevisiae|4932|Ile|TAT': [46], '>tdbR00000494|Saccharomyces_cerevisiae|4932|Trp|CCA': [45], '>tdbR00000323|Saccharomyces_cerevisiae|4932|Pro|TGG': [45], '>tdbR00000464|Saccharomyces_cerevisiae|4932|Val|AAC': [47], '>tdbR00000193|Saccharomyces_cerevisiae|4932|Lys|TTT': [46], '>tdbR00000284|Saccharomyces_cerevisiae|4932|Met|CAT': [46], '>tdbM00000007|Saccharomyces_cerevisiae|4932|Ini|CAT': [45], '>tdbR00000324|Saccharomyces_cerevisiae|4932|Pro|TGG': [45], '>tdbR00000021|Saccharomyces_cerevisiae|4932|Cys|GCA': [45], '>short_subunit': [1575], '>tdbR00000526|Saccharomyces_cerevisiae|4932|Ini|CAT': [45], '>tdbR00000465|Saccharomyces_cerevisiae|4932|Val|CAC': [46], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [46]}, u'Y': {'>tdbR00000083|Saccharomyces_cerevisiae|4932|Phe|GAA': [37], '>tdbR00000084|Saccharomyces_cerevisiae|4932|Phe|GAA': [37]}}, 'N': {u'.': {'>tdbR00000130|Saccharomyces_cerevisiae|4932|Gly|NCC': [34]}}}

annotationsbypos = {}

for origbase in annotations:
    for mod in annotations[origbase]:
        for refseg in (annotations[origbase])[mod]:
            if refseg not in annotationsbypos:
                annotationsbypos[refseg] = {}
            for pos in ((annotations[origbase])[mod])[refseg]:
                if pos not in annotationsbypos[refseg]:
                    (annotationsbypos[refseg])[pos] = mod

trivialmodnames = {'': '5\xe2\x80\xb2-alpha-methylphosphate end', '\xcf\xaa': 'N6-hydroxymethyladenosine', '\xcf\xa8': 'N6-formyladenosine', 'V': 'uridine 5-oxyacetic acid', '\xce\xb1': '1-methyl-3-(3-amino-3-carboxypropyl)pseudouridine', 'Z': '2\xe2\x80\xb2-O-methylpseudouridine', '$': '5-carboxymethylaminomethyl-2-thiouridine', '\xcf\x89': '2-selenouridine', '\xcf\x88': 'preQ0base', '\xcf\x87': 'N6,2\xe2\x80\xb2-O-dimethyladenosine', '\xcf\x86': '7-cyano-7-deazaguanosine', '\xcf\x85': 'uridine 5-oxyacetic acid methyl ester', '\xcf\x84': '5,2\xe2\x80\xb2-O-dimethylcytidine', '\xcf\x83': '3,2\xe2\x80\xb2-O-dimethyluridine', ',': '5-(carboxyhydroxymethyl)uridine methyl ester', '\xcf\x81': '5-methyldihydrouridine', '\xcf\x80': '5-aminomethyl-2-selenouridine', '4': '4-thiouridine', '\xcf\x96': '5\xe2\x80\xb2 triphosphate end', '\xcf\x92': '5\xe2\x80\xb2 diphosphate end', '\xcf\x91': 'guanylylated 5\xe2\x80\xb2 end (cap G)', '\xce\xa9': '7-aminocarboxypropylwyosine', '\xe2\x82\xac': 'wyosine', 'D': 'dihydrouridine', '\xe2\x88\x85': '5-hydroxymethylcytidine', 'L': 'N2-methylguanosine', 'P': 'pseudouridine', '\xce\xba': '3-methylpseudouridine', '\xce\xbb': 'N4,2\xe2\x80\xb2-O-dimethylcytidine', '\xce\xbc': 'N4,N4-dimethylcytidine', 'T': '5-methyluridine', '\xce\xbe': '1,2\xe2\x80\xb2-O-dimethylinosine', 'X': '3-(3-amino-3-carboxypropyl)uridine', '\xce\xb2': 'N4,N4,2\xe2\x80\xb2-O-trimethylcytidine', '\xce\xb3': 'N2,2\xe2\x80\xb2-O-dimethylguanosine', '\xce\xb4': '3-methyluridine', '\\': '5,2\xe2\x80\xb2-O-dimethyluridine', '\xce\xb6': 'N6,N6-dimethyladenosine', '\xce\xb7': 'N6,N6,2\xe2\x80\xb2-O-trimethyladenosine', '`': 'N6-(cis-hydroxyisopentenyl)adenosine', 'h': '5-methylaminomethyl-2-geranylthiouridine', 'l': '5-carbamoylmethyl-2-thiouridine', '\xce\xb5': '1,2\xe2\x80\xb2-O-dimethylguanosine', '\xce\x9e': '5\xe2\x80\xb2 nicotinamide adenine dinucleotide', '\xce\x93': '2-geranylthiouridine', '\xce\x94': '5-aminomethyl-2-geranylthiouridine', '\xc2\xae': 'N2,7-dimethylguanosine cap (cap DMG)', '\xd1\xb6': '5-cyanomethyluridine', '\xc2\xa7': 'gamma-methyltriphosphate cap', '#': '2\xe2\x80\xb2-O-methylguanosine', "'": '3-methylcytidine', '+': 'N6-isopentenyladenosine', '/': '2-methyladenosine', '\xe2\x87\x91': '7-aminocarboxypropylwyosine methyl ester', '3': '5-methoxycarbonylmethyl-2-thiouridine', '\xe2\x87\x93': 'N6-acetyladenosine', '(': 'archaeosine', '7': '7-methylguanosine', ';': 'unknown modified guanosine', '?': '5-methylcytidine', 'C': 'cytidine', 'G': 'guanosine', 'K': '1-methylguanosine', 'O': '1-methylinosine', '\xe2\x84\xb5': 'N4-acetyl-2\xe2\x80\xb2-O-methylcytidine', 'S': '5-methylaminomethyl-2-thiouridine', '\xe2\x88\xaa': '5-aminomethyluridine', 'W': 'peroxywybutosine', '\xe2\x97\x8a': '5-carboxymethyluridine', '|': 'N2,N2,2\xe2\x80\xb2-O-trimethylguanosine', '\xe2\x84\x91': '2\xe2\x80\xb2-O-ribosylguanosine (phosphate)', '\xe2\x88\xa0': 'N2,N2,7-trimethylguanosine', '{': '5-methylaminomethyluridine', '\xe2\x84\x98': '5-carboxymethyl-2-thiouridine', '\xe2\x88\x89': '7-aminomethyl-7-deazaguanosine', '\xc3\x8a': '5-taurinomethyluridine', '\xc3\x8e': 'unknown methylated base', '\xe2\x88\x8f': '2-thio-2\xe2\x80\xb2-O-methyluridine', '\xe2\x88\x83': '5-taurinomethyl-2-thiouridine', '\xc3\x87': '5-hydroxycytidine', '\xe2\x88\x87': 'preQ1base', '\xcf\x82': 'epoxyqueuosine', '\xe2\x88\x9a': 'N6-hydroxynorvalylcarbamoyladenosine', '\xe2\x88\x9d': '5-hydroxyuridine', '\xc3\x9e': '3-(3-amino-3-carboxypropyl)pseudouridine', '\xe2\x88\x9e': '2-methylthio-N6-methyladenosine', '\xe2\x88\x91': 'methylwyosine', '\xc3\x90': '3-(3-amino-3-carboxypropyl)-5,6-dihydrouridine', '[': '2-methylthio-N6-threonylcarbamoyladenosine', '\xe2\x88\xa9': '5-methoxycarbonylmethyl-2\xe2\x80\xb2-O-methyluridine', '\xe2\x88\xa8': 'N2,7-dimethylguanosine', '\xe2\x88\xab': '5-aminomethyl-2-thiouridine', '"': '1-methyladenosine', '&': '5-carbamoylmethyluridine', '\xc3\xa2': '8-methyladenosine', '*': '2-methylthio-N6-isopentenyladenosine', '\xc3\xa6': 'N2,7,2\xe2\x80\xb2-O-trimethylguanosine', '.': 'unknown nucleotide residue', '2': '2-thiouridine', '6': 'N6-threonylcarbamoyladenosine', ':': '2\xe2\x80\xb2-O-methyladenosine', '\xe2\x88\xb4': 'Qbase', '>': '5-formylcytidine', 'B': '2\xe2\x80\xb2-O-methylcytidine', '\xe2\x89\x88': '2-methylthio-N6-hydroxynorvalylcarbamoyladenosine', 'F': '5-methyl-2-thiouridine', '\xe2\x89\x85': '5-methylaminomethyl-2-selenouridine', 'N': 'unknown modified uridine', 'R': 'N2,N2-dimethylguanosine', '8': 'mannosyl-queuosine', '\xe2\x99\xa6': '5\xe2\x80\xb2 (3\xe2\x80\xb2 -dephosphosuccinyl-CoA)', '\xe2\x99\xa5': '5\xe2\x80\xb2 (3\xe2\x80\xb2 -dephosphomalonyl-CoA)', '\xe2\x99\xa3': '5\xe2\x80\xb2 (3\xe2\x80\xb2 -dephosphoacetyl-CoA)', '\xe2\x99\xa0': '5\xe2\x80\xb2 (3\xe2\x80\xb2 -dephospho-CoA)', '^': '2\xe2\x80\xb2-O-ribosyladenosine (phosphate)', '\xc2\xa5': '7-aminocarboxypropyl-demethylwyosine', 'none': 'guanosine added to any nucleotide', 'b': '5-(carboxyhydroxymethyl)-2\xe2\x80\xb2-O-methyluridine methyl ester', 'f': '5-carboxymethylaminomethyl-2-geranylthiouridine', '\xe2\x89\xa4': '2\xe2\x80\xb2-O-methylinosine', '\xe2\x89\xa5': '5-carboxyhydroxymethyluridine', '\xc2\xa9': '7-methylguanosine cap (cap 0)', '\xe2\x89\xa0': '2-methylthio-N6-(cis-hydroxyisopentenyl) adenosine', '\xe2\x89\xa1': 'N6-glycinylcarbamoyladenosine', '\xc2\xb6': 'N2,N2,7-trimethylguanosine cap (cap TMG)', 'r': '5-carbamoylhydroxymethyluridine', '\xc2\xb0': '5-formyl-2\xe2\x80\xb2-O-methylcytidine', '\xc2\xb1': '2,8-dimethyladenosine', '\xc2\xbc': '5-(isopentenylaminomethyl)-2\xe2\x80\xb2-O-methyluridine', '\xc2\xbd': '5-(isopentenylaminomethyl)-2-thiouridine', '\xc2\xbe': '5-(isopentenylaminomethyl)uridine', '\xc2\xbf': 'agmatidine', '~': '5-carbamoylmethyl-2\xe2\x80\xb2-O-methyluridine', '\xe2\x8a\x87': 'isowyosine', '\xe2\x8a\x86': 'hydroxywybutosine', '\xe2\x8a\x84': 'glutamyl-queuosine', '@': 'unknown modification', '\xc5\x93': '1,2\xe2\x80\xb2-O-dimethyladenosine', '!': '5-carboxymethylaminomethyluridine', '\xe2\x8a\xa5': '5-carboxymethylaminomethyl-2-selenouridine', '%': '2-thiocytidine', ')': '5-carboxymethylaminomethyl-2\xe2\x80\xb2-O-methyluridine', '\xc5\xa1': 'undermodified hydroxywybutosine', '1': '5-methoxycarbonylmethyluridine', '5': '5-methoxyuridine', 'H': 'unknown modified adenosine', '9': 'galactosyl-queuosine', '=': 'N6-methyladenosine', 'A': 'adenosine', 'J': '2\xe2\x80\xb2-O-methyluridine', 'E': 'N6-methyl-N6-threonylcarbamoyladenosine', 'I': 'inosine', 'M': 'N4-acetylcytidine', 'Q': 'queuosine', '\xe2\x80\xa0': '4-demethylwyosine', 'U': 'uridine', 'Y': 'wybutosine', ']': '1-methylpseudouridine', 'e': 'cyclic N6-threonylcarbamoyladenosine', 'm': '5\xe2\x80\xb2 monophosphate end', 'y': 'methylated undermodified hydroxywybutosine', '}': '2-lysidine', '<': 'unknown modified cytidine', '\xce\xbd': 'N4-methylcytidine'}

def gettrivialmodname (ref, pos):
    try:
        return trivialmodnames[(annotationsbypos[">" + ref])[pos]]
    except:
        return "N6,N6-dimethyladenosine"


annotated = 0
unannotated = 0

duplicatealarm = {}
linelist = []
with open(sys.argv[1]) as fin, open(sys.argv[2], 'w') as fout:
	fout.write("arrest_rate\trelmism\trh5_relmism_per_arrest_rate\trh6_foldchange_arrest_rate\t" + mismFeatureSet[sys.argv[3]] + "right\tmod_type\n")

	for line in fin:
                if line.startswith('#') or len(line) == 0:
                    continue
		splitlist = line.strip().split("\t")
		# refseg    pos    arrest_rate    relmism    rh5_relmism_per_arrest_rate    rh6_foldchange_arrest_rate    gmism    tmism    cmism    leftbase    rightbase    rightrightbase    diversity    cov    mod_type
		if len(splitlist) >= 11:
			if (int(splitlist[1]), (">" + splitlist[0])) in duplicatealarm:
				print item
				print (int(splitlist[1]), (">" + splitlist[0]))
			else:
				duplicatealarm[(int(splitlist[1]), (">" + splitlist[0]))] = 1
			if int(splitlist[1]) in annotationsbypos[">" + splitlist[0]]:
				
				linelist.append(splitlist[2] + "\t" + splitlist[3] + "\t" + splitlist[4] + "\t" + splitlist[5] + "\t" + splitlist[6] + "\t" + splitlist[7] + "\t" + splitlist[8] + "\t" + "'" + splitlist[10] + "'" + "\t" + "'" + gettrivialmodname(splitlist[0], int(splitlist[1])) + "'" + "\n")
				annotated += 1
			else:
				unannotated += 1

	shuffle(linelist)
	[fout.write(line) for line in linelist]

poolsize = 0
for origbase in annotations:
    for mod in annotations[origbase]:
        for refseg in (annotations[origbase])[mod]:
            for pos in ((annotations[origbase])[mod])[refseg]:
                poolsize += 1


print "annotationpool size", poolsize

print "annotated", annotated
print "unannotated", unannotated
print "annotated / all", float(annotated)/(annotated+unannotated)

